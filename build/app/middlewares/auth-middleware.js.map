{"version":3,"sources":["../../../src/app/middlewares/auth-middleware.js"],"names":["getToken","headers","authorization","split","bearer","token","authMiddleware","secret","JWT_SECRET","unless","path"],"mappings":";;;;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AAEO,IAAMA,QAAQ,GAAG,SAAXA,QAAW,OAAiB;AAAA,MAAdC,OAAc,QAAdA,OAAc;;AACvC,MAAI,CAACA,OAAO,CAACC,aAAb,EAA4B;AAC1B,UAAM,2BAAa,4BAAb,CAAN;AACD;;AAHsC,8BAKfD,OAAO,CAACC,aAAR,CAAsBC,KAAtB,CAA4B,GAA5B,CALe;AAAA;AAAA,MAKhCC,MALgC;AAAA,MAKxBC,KALwB;;AAMvC,MAAID,MAAM,KAAK,QAAf,EAAyB;AACvB,UAAM,2BAAa,eAAb,CAAN;AACD;;AAED,SAAOC,KAAP;AACD,CAXM;;;AAaA,IAAMC,cAAc,GAAG,wBAAI;AAChCC,EAAAA,MAAM,EAAEC,kBADwB;AAEhCR,EAAAA,QAAQ,EAARA;AAFgC,CAAJ,EAG3BS,MAH2B,CAGpB;AACRC,EAAAA,IAAI,EAAE,CACJ,gBADI,EAEJ,0BAFI,EAGJ,gCAHI,EAIJ,iBAJI,EAKJ,gBALI,EAMJ,6BANI,EAOJ,iBAPI,EAQJ,iBARI,EASJ,SATI,EAUJ,GAVI,EAWJ,WAXI,EAYJ,sBAZI,EAaJ,qBAbI,EAcJ,mBAdI,EAeJ,qBAfI;AADE,CAHoB,CAAvB","sourcesContent":["import jwt from 'koa-jwt'\n\nimport { JWT_SECRET } from '../config'\nimport { Unauthorized } from '../helpers'\nimport User from '../models/user'\n\nexport const getToken = ({ headers }) => {\n  if (!headers.authorization) {\n    throw Unauthorized('You need to submit a token')\n  }\n\n  const [bearer, token] = headers.authorization.split(' ')\n  if (bearer !== 'Bearer') {\n    throw Unauthorized('Invalid token')\n  }\n\n  return token\n}\n\nexport const authMiddleware = jwt({\n  secret: JWT_SECRET,\n  getToken\n}).unless({\n  path: [\n    '/v1/auth/login',\n    '/v1/auth/login-marketing',\n    '/v1/auth/login-logistics-admin',\n    '/v1/auth/forget',\n    '/v1/auth/reset',\n    '/v1/auth/guest/authenticate',\n    '/v1/auth/verify',\n    '/v1/auth/resend',\n    '/public',\n    '/',\n    '/v1/banks',\n    '/v1/api/swagger-html',\n    /^\\/v1\\/internal\\/.*/,\n    /^\\/v1\\/posist\\/.*/,\n    /^\\/v1\\/paystack\\/.*/\n  ]\n})\n"],"file":"auth-middleware.js"}