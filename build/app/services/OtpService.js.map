{"version":3,"sources":["../../../src/app/services/OtpService.js"],"names":["OtpService","phone_number","action","otp","Otp","query","findOne","otpToCreate","patchAndFetchById","id","otp_token","JwtService","sign","expiresIn","process","env","OTP_EXPIRATION","insert","instance"],"mappings":";;;;;;;;;;;;;;;;;AAAA;;AACA;;IAEaA,U;;;;;;;;mGACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgBC,gBAAAA,YAAhB,QAAgBA,YAAhB,EAA8BC,MAA9B,QAA8BA,MAA9B;AACQC,gBAAAA,GADR,GACc,MADd;AAAA;AAAA,uBAE4BC,gBAAIC,KAAJ,GACvBC,OADuB,CACf;AACPL,kBAAAA,YAAY,EAAZA,YADO;AAEPC,kBAAAA,MAAM,EAANA;AAFO,iBADe,WAKjB;AAAA,yBAAM,KAAN;AAAA,iBALiB,CAF5B;;AAAA;AAEQK,gBAAAA,WAFR;;AAAA,qBASMA,WATN;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAUUH,gBAAIC,KAAJ,GAAYG,iBAAZ,CAA8BD,WAAW,CAACE,EAA1C,EAA8C;AAClDC,kBAAAA,SAAS,EAAEC,uBAAWC,IAAX,CACT;AAAEX,oBAAAA,YAAY,EAAZA,YAAF;AAAgBE,oBAAAA,GAAG,EAAHA,GAAhB;AAAqBD,oBAAAA,MAAM,EAANA;AAArB,mBADS,EAET;AAAEW,oBAAAA,SAAS,EAAEC,OAAO,CAACC,GAAR,CAAYC,cAAZ,IAA8B;AAA3C,mBAFS;AADuC,iBAA9C,CAVV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,uBAiBUZ,gBAAIC,KAAJ,GAAYY,MAAZ,CAAmB;AACvBhB,kBAAAA,YAAY,EAAZA,YADuB;AAEvBC,kBAAAA,MAAM,EAANA,MAFuB;AAGvBQ,kBAAAA,SAAS,EAAEC,uBAAWC,IAAX,CACT;AAAEX,oBAAAA,YAAY,EAAZA,YAAF;AAAgBE,oBAAAA,GAAG,EAAHA,GAAhB;AAAqBD,oBAAAA,MAAM,EAANA;AAArB,mBADS,EAET;AAAEW,oBAAAA,SAAS,EAAEC,OAAO,CAACC,GAAR,CAAYC,cAAZ,IAA8B;AAA3C,mBAFS;AAHY,iBAAnB,CAjBV;;AAAA;AAAA,iDA0BS;AAAEb,kBAAAA,GAAG,EAAHA;AAAF,iBA1BT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;;;AA8BF,IAAMe,QAAQ,GAAG,IAAIlB,UAAJ,EAAjB;eAEekB,Q","sourcesContent":["import Otp from '../models/otp'\nimport JwtService from './JwtService'\n\nexport class OtpService {\n  async sendOtp({ phone_number, action }) {\n    const otp = '2021'\n    const otpToCreate = await Otp.query()\n      .findOne({\n        phone_number,\n        action\n      })\n      .catch(() => false)\n\n    if (otpToCreate) {\n      await Otp.query().patchAndFetchById(otpToCreate.id, {\n        otp_token: JwtService.sign(\n          { phone_number, otp, action },\n          { expiresIn: process.env.OTP_EXPIRATION || '10m' }\n        )\n      })\n    } else {\n      await Otp.query().insert({\n        phone_number,\n        action,\n        otp_token: JwtService.sign(\n          { phone_number, otp, action },\n          { expiresIn: process.env.OTP_EXPIRATION || '10m' }\n        )\n      })\n    }\n    return { otp }\n  }\n}\n\nconst instance = new OtpService()\n\nexport default instance\n"],"file":"OtpService.js"}